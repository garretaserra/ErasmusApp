(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{"zRx/":function(n,l,e){"use strict";e.r(l);var t=e("8Y7J");class u{}var o=e("pMnS"),s=e("oBZk"),i=e("ZZ/e"),a=e("SVse"),r=e("s7LF"),b=e("mrSG"),c=e("sjK5"),m=e("25lC"),g=e("TVc2");class p{constructor(n,l,e,t){this.route=n,this.chatService=l,this.storage=e,this.router=t,this.name=this.route.snapshot.paramMap.get("name"),setTimeout(()=>this.scrollToBottom(),500)}ngOnInit(){return b.b(this,void 0,void 0,(function*(){this.user=JSON.parse(this.storage.getUser()),yield this.chatService.getStoredMessages().toPromise().then(n=>{this.messages=n.filter(n=>n.author===this.name||n.destination===this.name),this.chatService.ackMsg(this.name)}),this.chatService.getMessage().subscribe(n=>{n.email===this.name&&(this.messages.push(new g.a("",n.email,this.name,n.message,new Date,!0,0)),setTimeout(()=>this.scrollToBottom(),50),this.router.url==="/conversation/"+this.name&&this.chatService.ackMsg(this.name))}),this.chatService.getACK().subscribe(n=>{console.log("ACK received from "+n),this.messages.forEach(n=>n.read=!0)})}))}onEnter(n){this.message=n,this.sendMessage()}sendMessage(){this.message.replace(/\s/g,"").length&&(this.messages.push(new g.a("",this.user.name,this.name,this.message,new Date,!1,0)),this.chatService.sendMessage(this.message,this.name),setTimeout(()=>this.scrollToBottom(),50))}zeroPad(n){return n.toString().length<2?"0"+n:n}formatDate(n){const l=new Date(n),e=l.getDate(),t=l.getMonth(),u=l.getFullYear(),o=this.zeroPad(l.getHours()),s=this.zeroPad(l.getMinutes()),i=this.zeroPad(l.getSeconds());return e+" "+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t]+" "+u+" "+o+":"+s+":"+i}scrollToBottom(){return b.b(this,void 0,void 0,(function*(){yield this.myContent.scrollToBottom(500)}))}}var d=e("iInd"),h=t.Bb({encapsulation:0,styles:[['.messages_list[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{border:0 transparent!important}.messages_list[_ngcontent-%COMP%]   .message_bubble[_ngcontent-%COMP%]{width:100%;margin:0!important;display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.messages_list[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{border-radius:10px;padding:8px 15px;margin-top:5px;margin-bottom:5px;display:inline-block;color:#333}.messages_list[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .faded[_ngcontent-%COMP%]{opacity:.5}.messages_list[_ngcontent-%COMP%]   .mine[_ngcontent-%COMP%]{-webkit-box-align:start;align-items:flex-start}.messages_list[_ngcontent-%COMP%]   .mine[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{margin-right:25%;background-color:#eee;position:relative}.messages_list[_ngcontent-%COMP%]   .mine[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]:before{content:"";position:absolute;z-index:0;bottom:0;left:-7px;height:20px;width:20px;background:#eee;border-bottom-right-radius:15px}.messages_list[_ngcontent-%COMP%]   .mine[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]:after{content:"";position:absolute;z-index:1;bottom:0;left:-10px;width:10px;height:20px;background:#fff;border-bottom-right-radius:10px}.messages_list[_ngcontent-%COMP%]   .yours[_ngcontent-%COMP%]{-webkit-box-align:end;align-items:flex-end}.messages_list[_ngcontent-%COMP%]   .yours[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{color:#fff;margin-left:25%;background:fixed #3880ff;position:relative}.messages_list[_ngcontent-%COMP%]   .yours[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]:before{content:"";position:absolute;z-index:0;bottom:0;right:-8px;height:20px;width:20px;background:fixed #3880ff;border-bottom-left-radius:15px}.messages_list[_ngcontent-%COMP%]   .yours[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]:after{content:"";position:absolute;z-index:1;bottom:0;right:-10px;width:10px;height:20px;background:#fff;border-bottom-left-radius:10px}.send_form[_ngcontent-%COMP%]{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;-webkit-box-align:center;align-items:center;background-color:#fff}.send_form_input[_ngcontent-%COMP%]{-webkit-box-flex:1;flex:1}.send_form_button[_ngcontent-%COMP%]{text-align:right;max-width:120px}']],data:{}});function f(n){return t.Yb(0,[(n()(),t.Db(0,0,null,null,1,"ion-icon",[["color","primary"],["name","checkmark"]],null,null,null,s.Z,s.s)),t.Cb(1,49152,null,0,i.D,[t.j,t.p,t.G],{color:[0,"color"],name:[1,"name"]},null)],(function(n,l){n(l,1,0,"primary","checkmark")}),null)}function C(n){return t.Yb(0,[(n()(),t.Db(0,0,null,null,1,"ion-icon",[["color","success"],["name","done-all"]],null,null,null,s.Z,s.s)),t.Cb(1,49152,null,0,i.D,[t.j,t.p,t.G],{color:[0,"color"],name:[1,"name"]},null)],(function(n,l){n(l,1,0,"success","done-all")}),null)}function x(n){return t.Yb(0,[(n()(),t.Db(0,0,null,null,11,"div",[["class","message_bubble yours"]],null,null,null,null,null)),(n()(),t.Db(1,0,null,null,10,"div",[["class","message"]],null,null,null,null,null)),(n()(),t.Db(2,0,null,null,1,"span",[["class","faded"]],null,null,null,null,null)),(n()(),t.Wb(-1,null,["Me: "])),(n()(),t.Wb(4,null,[" "," "])),(n()(),t.Db(5,0,null,null,0,"br",[],null,null,null,null,null)),(n()(),t.sb(16777216,null,null,1,null,f)),t.Cb(7,16384,null,0,a.j,[t.Y,t.U],{ngIf:[0,"ngIf"]},null),(n()(),t.sb(16777216,null,null,1,null,C)),t.Cb(9,16384,null,0,a.j,[t.Y,t.U],{ngIf:[0,"ngIf"]},null),(n()(),t.Db(10,0,null,null,1,"span",[["class","faded"],["style","font-size: x-small"]],null,null,null,null,null)),(n()(),t.Wb(11,null,["",""]))],(function(n,l){n(l,7,0,0==l.parent.context.$implicit.read),n(l,9,0,1==l.parent.context.$implicit.read)}),(function(n,l){var e=l.component;n(l,4,0,l.parent.context.$implicit.text),n(l,11,0,e.formatDate(l.parent.context.$implicit.timestamp))}))}function _(n){return t.Yb(0,[(n()(),t.Db(0,0,null,null,7,"div",[["class","message_bubble mine"]],null,null,null,null,null)),(n()(),t.Db(1,0,null,null,6,"span",[["class","message"]],null,null,null,null,null)),(n()(),t.Db(2,0,null,null,1,"span",[["class","faded"]],null,null,null,null,null)),(n()(),t.Wb(3,null,["",": "])),(n()(),t.Wb(4,null,[" "," "])),(n()(),t.Db(5,0,null,null,0,"br",[],null,null,null,null,null)),(n()(),t.Db(6,0,null,null,1,"span",[["class","faded"],["style","font-size: x-small"]],null,null,null,null,null)),(n()(),t.Wb(7,null,["",""]))],null,(function(n,l){var e=l.component;n(l,3,0,e.name),n(l,4,0,l.parent.context.$implicit.text),n(l,7,0,e.formatDate(l.parent.context.$implicit.timestamp))}))}function M(n){return t.Yb(0,[(n()(),t.Db(0,0,null,null,5,"ion-item",[["lines","none"]],null,null,null,s.bb,s.u)),t.Cb(1,49152,null,0,i.I,[t.j,t.p,t.G],{lines:[0,"lines"]},null),(n()(),t.sb(16777216,null,0,1,null,x)),t.Cb(3,16384,null,0,a.j,[t.Y,t.U],{ngIf:[0,"ngIf"]},null),(n()(),t.sb(16777216,null,0,1,null,_)),t.Cb(5,16384,null,0,a.j,[t.Y,t.U],{ngIf:[0,"ngIf"]},null)],(function(n,l){var e=l.component;n(l,1,0,"none"),n(l,3,0,l.context.$implicit.author===e.user.name),n(l,5,0,l.context.$implicit.author!==e.user.name)}),null)}function P(n){return t.Yb(0,[t.Ub(402653184,1,{myContent:0}),(n()(),t.Db(1,0,null,null,11,"ion-header",[],null,null,null,s.Y,s.r)),t.Cb(2,49152,null,0,i.C,[t.j,t.p,t.G],null,null),(n()(),t.Db(3,0,null,0,9,"ion-toolbar",[],null,null,null,s.nb,s.G)),t.Cb(4,49152,null,0,i.Db,[t.j,t.p,t.G],null,null),(n()(),t.Db(5,0,null,0,4,"ion-buttons",[["slot","start"]],null,null,null,s.M,s.f)),t.Cb(6,49152,null,0,i.m,[t.j,t.p,t.G],null,null),(n()(),t.Db(7,0,null,0,2,"ion-back-button",[],null,[[null,"click"]],(function(n,l,e){var u=!0;return"click"===l&&(u=!1!==t.Pb(n,9).onClick(e)&&u),u}),s.J,s.c)),t.Cb(8,49152,null,0,i.h,[t.j,t.p,t.G],null,null),t.Cb(9,16384,null,0,i.i,[[2,i.jb],i.Jb],null,null),(n()(),t.Db(10,0,null,0,2,"ion-title",[],null,null,null,s.mb,s.F)),t.Cb(11,49152,null,0,i.Bb,[t.j,t.p,t.G],null,null),(n()(),t.Wb(12,0,[""," - Conversation"])),(n()(),t.Db(13,0,null,null,5,"ion-content",[["id","scroll-this"]],null,null,null,s.V,s.o)),t.Cb(14,49152,[[1,4]],0,i.v,[t.j,t.p,t.G],null,null),(n()(),t.Db(15,0,null,0,3,"ion-list",[["class","messages_list"]],null,null,null,s.eb,s.w)),t.Cb(16,49152,null,0,i.P,[t.j,t.p,t.G],null,null),(n()(),t.sb(16777216,null,0,1,null,M)),t.Cb(18,278528,null,0,a.i,[t.Y,t.U,t.y],{ngForOf:[0,"ngForOf"]},null),(n()(),t.Db(19,0,null,null,14,"ion-footer",[["class","send_form"]],null,null,null,s.W,s.p)),t.Cb(20,49152,null,0,i.A,[t.j,t.p,t.G],null,null),(n()(),t.Db(21,0,null,0,5,"ion-col",[["class","send_form_input"]],null,null,null,s.U,s.n)),t.Cb(22,49152,null,0,i.u,[t.j,t.p,t.G],null,null),(n()(),t.Db(23,0,null,0,3,"ion-textarea",[["placeholder","Type a message..."]],null,[[null,"keyup.enter"],[null,"ionBlur"],[null,"ionChange"]],(function(n,l,e){var u=!0,o=n.component;return"ionBlur"===l&&(u=!1!==t.Pb(n,26)._handleBlurEvent(e.target)&&u),"ionChange"===l&&(u=!1!==t.Pb(n,26)._handleInputEvent(e.target)&&u),"keyup.enter"===l&&(o.onEnter(t.Pb(n,25).value),u=!1!==(t.Pb(n,25).value="")&&u),u}),s.lb,s.E)),t.Tb(5120,null,r.k,(function(n){return[n]}),[i.Nb]),t.Cb(25,49152,[["box",4]],0,i.zb,[t.j,t.p,t.G],{placeholder:[0,"placeholder"]},null),t.Cb(26,16384,null,0,i.Nb,[t.p],null,null),(n()(),t.Db(27,0,null,0,6,"ion-col",[["class","send_form_button"]],null,null,null,s.U,s.n)),t.Cb(28,49152,null,0,i.u,[t.j,t.p,t.G],null,null),(n()(),t.Db(29,0,null,0,4,"ion-button",[],null,[[null,"click"]],(function(n,l,e){var u=!0;return"click"===l&&(n.component.onEnter(t.Pb(n,25).value),u=!1!==(t.Pb(n,25).value="")&&u),u}),s.L,s.e)),t.Cb(30,49152,null,0,i.l,[t.j,t.p,t.G],null,null),(n()(),t.Wb(-1,0,[" Send "])),(n()(),t.Db(32,0,null,0,1,"ion-icon",[["name","send"],["size","large"],["slot","end"]],null,null,null,s.Z,s.s)),t.Cb(33,49152,null,0,i.D,[t.j,t.p,t.G],{name:[0,"name"],size:[1,"size"]},null)],(function(n,l){n(l,18,0,l.component.messages),n(l,25,0,"Type a message..."),n(l,33,0,"send","large")}),(function(n,l){n(l,12,0,l.component.name)}))}function v(n){return t.Yb(0,[(n()(),t.Db(0,0,null,null,1,"app-conversation",[],null,null,null,P,h)),t.Cb(1,114688,null,0,p,[d.a,c.a,m.a,d.m],null,null)],(function(n,l){n(l,1,0)}),null)}var D=t.zb("app-conversation",p,v,{},{},[]);class O{}e.d(l,"ConversationPageModuleNgFactory",(function(){return k}));var k=t.Ab(u,[],(function(n){return t.Mb([t.Nb(512,t.m,t.lb,[[8,[o.a,D]],[3,t.m],t.E]),t.Nb(4608,a.l,a.k,[t.A,[2,a.w]]),t.Nb(4608,r.u,r.u,[]),t.Nb(4608,i.b,i.b,[t.G,t.g]),t.Nb(4608,i.Ib,i.Ib,[i.b,t.m,t.x]),t.Nb(4608,i.Lb,i.Lb,[i.b,t.m,t.x]),t.Nb(1073742336,a.b,a.b,[]),t.Nb(1073742336,r.t,r.t,[]),t.Nb(1073742336,r.i,r.i,[]),t.Nb(1073742336,i.Fb,i.Fb,[]),t.Nb(1073742336,d.p,d.p,[[2,d.u],[2,d.m]]),t.Nb(1073742336,O,O,[]),t.Nb(1073742336,u,u,[]),t.Nb(1024,d.k,(function(){return[[{path:"",component:p}]]}),[])])}))}}]);